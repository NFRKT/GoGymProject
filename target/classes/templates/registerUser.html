<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>GoGym - Rejestracja</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
  <style>
    body { font-family: "Lato", sans-serif; background-color: #f0f0f0; }
    .register-container {
        max-width: 500px;
        margin: auto;
        padding: 30px;
        background: white;
        border-radius: 10px;
        box-shadow: 0px 0px 10px rgba(0,0,0,0.2);
    }
    .error-message {
        color: red;
        font-size: 0.9em;
        display: none;
    }
  </style>
</head>
<body>
<div class="w3-container w3-padding-64 w3-center">
  <h2>GoGym - Rejestracja</h2>
  <div class="register-container">
    <form id="registrationForm" th:action="@{/register}" th:object="${User}" method="post">
      <label>Email:</label>
      <input class="w3-input w3-border" type="email" id="email" th:field="*{email}" required>
      <div id="emailError" class="error-message">Wprowadź poprawny email.</div>

      <label>Hasło:</label>
      <input class="w3-input w3-border" type="password" id="password" th:field="*{password}" required>
      <div id="passwordError" class="error-message">Hasło min. 6 znaków, zawiera cyfrę i literę.</div>

      <label>Imię:</label>
      <input class="w3-input w3-border" type="text" id="firstName" th:field="*{firstName}" required>
      <div id="firstNameError" class="error-message">Wpisz poprawne imię.</div>

      <label>Nazwisko:</label>
      <input class="w3-input w3-border" type="text" id="secondName" th:field="*{secondName}" required>
      <div id="secondNameError" class="error-message">Wpisz poprawne nazwisko.</div>

      <label>Data urodzenia:</label>
      <input class="w3-input w3-border" type="date" id="birthDate" th:field="*{birthDate}" required>

      <label>Płeć:</label>
      <select class="w3-input w3-border" id="gender" th:field="*{gender}">
        <option value="KOBIETA">Kobieta</option>
        <option value="MĘŻCZYZNA">Mężczyzna</option>
      </select>

      <label>Typ użytkownika:</label>
      <select class="w3-input w3-border" id="userType" th:field="*{userType}">
        <option value="CLIENT">Użytkownik</option>
        <option value="TRAINER">Trener</option>
      </select>

      <!-- Pola dla trenerów -->
      <div id="trainerFields" style="display: none;">
        <label>Data rozpoczęcia działalności:</label>
        <input class="w3-input w3-border" type="date" id="startDate" th:field="*{startDate}" required>

        <label>Numer telefonu:</label>
        <input class="w3-input w3-border" type="text" id="phoneNumber" th:field="*{phoneNumber}" required>

        <label>Obszar pracy:</label>
        <input class="w3-input w3-border" type="text" id="workArea" th:field="*{workArea}">

        <label>Specjalizacje:</label>
        <div id="specializations">
          <div class="specialization-field">
            <input class="w3-input w3-border" type="text" name="specializations" required>
            <button type="button" onclick="addSpecialization()">Dodaj kolejną</button>
          </div>
        </div>
      </div>

      <button type="submit" class="w3-button w3-blue w3-margin-top w3-round">Zarejestruj</button>
    </form>
  </div>
</div>

<script>
  document.getElementById("userType").addEventListener("change", function() {
      document.getElementById("trainerFields").style.display = this.value === "TRAINER" ? "block" : "none";
  });

  function addSpecialization() {
      const specDiv = document.createElement("div");
      specDiv.classList.add("specialization-field");
      specDiv.innerHTML = '<input class="w3-input w3-border" type="text" name="specializations" required> <button type="button" onclick="this.parentElement.remove()">Usuń</button>';
      document.getElementById("specializations").appendChild(specDiv);
  }

  document.getElementById("registrationForm").addEventListener("submit", function(event) {
      let isValid = true;
      const email = document.getElementById("email");
      const password = document.getElementById("password");
      const firstName = document.getElementById("firstName");
      const secondName = document.getElementById("secondName");
      const emailError = document.getElementById("emailError");
      const passwordError = document.getElementById("passwordError");
      const firstNameError = document.getElementById("firstNameError");
      const secondNameError = document.getElementById("secondNameError");

      function setError(field, errorElement, message) {
          field.classList.add("w3-border-red");
          errorElement.textContent = message;
          errorElement.style.display = "block";
          isValid = false;
      }

      function resetError(field, errorElement) {
          field.classList.remove("w3-border-red");
          errorElement.style.display = "none";
      }

      resetError(email, emailError);
      resetError(password, passwordError);
      resetError(firstName, firstNameError);
      resetError(secondName, secondNameError);

      if (!email.value.includes("@")) setError(email, emailError, "Wprowadź poprawny email.");
      if (password.value.length < 6 || !/\d/.test(password.value) || !/[a-zA-Z]/.test(password.value)) {
          setError(password, passwordError, "Hasło musi zawierać co najmniej 6 znaków, literę i cyfrę.");
      }
      if (!/^[A-Z][a-z]+$/.test(firstName.value)) setError(firstName, firstNameError, "Imię musi zaczynać się wielką literą.");
      if (!/^[A-Z][a-z]+$/.test(secondName.value)) setError(secondName, secondNameError, "Nazwisko musi zaczynać się wielką literą.");

      if (!isValid) event.preventDefault();
  });
</script>
</body>
</html>
